{
  "id": "mermaid_compatibility_github_ado",
  "title": "Mermaid Diagram Compatibility: GitHub Markdown vs Azure DevOps (Updated)",
  "body": "# Mermaid Diagram Compatibility Matrix (Updated 2025-09-03)\n\nThis document explains cross-platform (GitHub Markdown vs Azure DevOps Wiki) Mermaid authoring plus newly validated troubleshooting practices gathered from recent remediation of broken diagrams in a large architecture doc set.\n\n## 1. Syntax Differences\n\n### GitHub Markdown\n- **Fence Syntax**: ```mermaid (standard fenced code block)\n- **Rendering**: Server-side (Mermaid.js latest; currently v11.10.x)\n- **Where**: README.md, issues, PRs, discussions, gists, wikis\n\n### Azure DevOps Wiki\n- **Fence Syntax**: ```mermaid (in most updated orgs) OR legacy ::: mermaid blocks (older guidance)\n- **Rendering Scope**: Wiki pages only (not repo README, PR descriptions)\n- **Runtime Version**: Typically lags GitHub (often ~1 major rev behind)\n\n## 2. Supported Diagram Types (Cross‑Checked)\n| Diagram Type | GitHub | Azure DevOps | Cross-Platform Guidance |\n|--------------|--------|-------------|--------------------------|\n| Flowchart / Graph | ✅ | ⚠️ (prefer `graph`) | Author using `graph` keyword for portability |\n| Sequence | ✅ | ✅ | Keep participant IDs simple (letters, digits, underscores) |\n| Class | ✅ | ✅ | Works; avoid complex generics in labels |\n| State | ✅ | ✅ | Use `stateDiagram-v2` (avoid v1) |\n| ERD | ✅ | ✅ | Basic only; advanced styling GitHub-only |\n| Journey | ✅ | ✅ | Minimal theming |\n| Gantt | ✅ | ✅ | Large charts can hit line-length limits; split when > ~150 lines |\n| Pie | ✅ | ✅ | Provide short labels (ADO truncates long) |\n| Requirements | ✅ | ✅ | Stable |\n| GitGraph | ✅ | ✅ | Avoid very long commit messages |\n| Timeline | ✅ | ✅ | Keep date formats consistent |\n| Mindmap | ✅ | ❌ | Replace with `graph` + subgraphs for ADO |\n| C4 (Context/Container) | ✅ | ❌ | Provide ASCII or simplified graph fallback |\n| XY Chart | ✅ | ❌ | Mark clearly as GitHub-only if used |\n| Block Diagram | ✅ | ❌ | Experimental – avoid for shared docs |\n| Sankey | ✅ | ❌ | Provide static image or omit |\n| Packet | ✅ | ❌ | Highly niche; skip cross-platform |\n| Architecture | ✅ | ❌ | New; not portable yet |\n| Kanban | ✅ | ❌ | Not portable |\n| Radar | ✅ | ❌ | Not portable |\n| Treemap | ✅ | ❌ | Not portable |\n| ZenUML | ✅ | ❌ | Use standard sequence instead |\n\n## 3. Newly Confirmed Practical Lessons (2025-09-03)\nRecent fixes uncovered recurring break causes. Apply these checklists before finalizing PRs.\n\n### 3.1 Formatting / Lint Interplay\n| Issue | Lint Rule | Symptom | Fix |\n|-------|-----------|---------|-----|\n| Missing blank line before fenced block | MD031 | Mermaid not detected (renders as plain text) | Insert blank line before and after ```mermaid fence |\n| Heading immediately followed by fence | MD022 | Some renderers skip diagram | Add blank line after heading |\n| Lists touching code fences | MD032 | Diagram or list misrender | Blank line above & below list block |\n| Trailing spaces in table rows | MD009 | Table reflow -> misaligned diagram anchors | Strip trailing spaces |\n| Non-breaking spaces in node labels | (none) | Invisible label mismatch errors | Replace with regular spaces |\n\n### 3.2 Node & Edge Patterns\n- Avoid bare parenthetical nodes like `(All)` – treat as text in some parsers causing break; convert to explicit node `All[All]` or expand into multiple explicit edges.\n- Edges to subgraph labels are unreliable; anchor with a representative node or create pseudo anchor nodes (e.g., `SVC[Services]`).\n- Keep arrow syntax to `-->`, `---`, `-->|label|` only. Avoid long arrow forms (`---->`), which ADO often ignores.\n- For grouping: `subgraph <ID>[Title]` then place nodes; use the ID for minimal cross-platform edge references (works better in `flowchart` than `graph` sometimes). If any renderer fails, fallback to explicit connector nodes.\n\n### 3.3 Mindmap & Unsupported Types Migration Pattern\n| Original (GitHub-only) | Portable Replacement Strategy |\n|------------------------|-------------------------------|\n| `mindmap` | Use `flowchart`/`graph` with `subgraph` clusters |\n| `C4Context` / `C4Container` | Simplify to `graph` with component nodes + stereotypes inside labels |\n| `sankey` | Provide summarized flowchart + numeric annotations |\n| `radar` | Replace with markdown table of dimensions + relative scores |\n\n### 3.4 ASCII Fallback Pattern (When Portability Critical)\nPlace immediately under the Mermaid block:\n```markdown\nFallback (ASCII):\n```text\nA -> B -> C\nA -> D\n```\n```\nEnsure the ASCII fence has a language (e.g., `text`) to satisfy MD040.\n\n### 3.5 Diagram Size & Maintainability\n- Prefer ≤ 60 lines per diagram; split large systems into layered diagrams.\n- Use concise node IDs; long text belongs in label `[Readable Description]` rather than ID.\n- Keep one concern per diagram (allocation flow, deployment gating, observability map) to reduce churn.\n\n### 3.6 Label Hygiene\n| Anti-Pattern | Risk | Replacement |\n|--------------|------|-------------|\n| Slashes in labels `Core/Util` | Sometimes parsed as division or theme artifact | `Core & Util` or `Core_Util` |\n| Pipes inside labels without escaping | Can break table formatting if embedded | Use `·` or `:` |\n| Excess punctuation (`,:;()` cluster) | Rendering inconsistencies | Simplify wording |\n\n### 3.7 Version Awareness\n| Feature | Requires Mermaid >= | GitHub | ADO |\n|---------|---------------------|--------|-----|\n| XY Chart | 11.9.0 | ✅ | ❌ |\n| Block Diagram | 11.9.0 | ✅ | ❌ |\n| Architecture | 11.10.0 | ✅ | ❌ |\n| Kanban | 11.10.0 | ✅ | ❌ |\n| Radar | 11.10.0 | ✅ | ❌ |\n\nFor maximum portability, constrain to features present in Mermaid 10.x core set.\n\n## 4. Authoring Checklist (Pre-Commit)\n1. All Mermaid fences have blank line before & after.\n2. No experimental diagram types in cross-platform docs.\n3. Replaced `flowchart` with `graph` where ADO support required OR confirmed ADO supports `flowchart` variant in your org.\n4. No edges to non-existent or subgraph-only labels; anchor nodes exist.\n5. Mindmap/C4 replaced or flagged (\"GitHub only\").\n6. Lint: MD022, MD031, MD032, MD040, MD009 all green.\n7. Provide ASCII fallback for critical diagrams (at least key topology & pipeline flows).\n8. Removed trailing spaces and deep indent anomalies.\n9. Node labels avoid slashes and unescaped pipes; use neutral separators.\n10. Added note if using GitHub-only diagrams clarifying portability.\n\n## 5. Automated Fix Script (Conceptual Pseudocode)\n```pseudo\nfor each markdown file:\n  parse lines\n  ensure blank line before/after ```mermaid fence\n  if diagram type == mindmap and portability flag set: rewrite to graph with subgraphs\n  normalize 'flowchart' -> 'graph' when portability required\n  detect edges using subgraph labels only -> insert anchor node\n  append ASCII fallback if portability-critical & missing\n  strip trailing spaces in tables / code fences\n```\n\n## 6. Migration Examples\n### 6.1 Mindmap → Graph Cluster\nOriginal:\n```mermaid\nmindmap\n  root((System))\n    Services\n      API\n      Worker\n```\nPortable:\n```mermaid\ngraph TD\n  subgraph Services\n    API\n    Worker\n  end\n  System[System] --> API\n  System --> Worker\n```\n\n### 6.2 Invalid Aggregate Node\nInvalid:\n```mermaid\ngraph LR\n  Tests --> (All)\n```\nFixed:\n```mermaid\ngraph LR\n  Tests --> Services\n  Tests --> Contracts\n  Tests --> SharedLibs\n```\n\n## 7. Theming & Styling Constraints\n| Feature | GitHub | ADO | Recommendation |\n|---------|--------|-----|----------------|\n| classDef styles | ✅ | ❌ | Avoid if cross-platform |\n| %%{init: }%% directives | ✅ | ❌ | Scope to GitHub-only docs |\n| Dark theme auto adjust | ✅ | ✅ | Trust platform; avoid forced colors |\n\n## 8. Troubleshooting Quick Table\n| Symptom | Likely Cause | Fix |\n|---------|--------------|-----|\n| Renders as plain text | Missing blank line before fence | Insert blank line |\n| Diagram partially missing | Edge to subgraph label only | Add anchor node | \n| Entire page breaks | Unclosed code fence earlier | Validate fence counts |\n| Mindmap not shown | Unsupported type (ADO) | Replace with graph clusters |\n| Table formatting corrupts diagram | Missing blank line separation | Add blank lines around table |\n| Lint MD040 | Missing language on ASCII fallback | Add `text` after fence |\n\n## 9. GitHub-Only Enhancement Strategy\nWhen GitHub is sole target:\n- You may keep `flowchart`, `mindmap`, experimental charts.\n- Document at top: \"This doc uses GitHub-only Mermaid features (mindmap, radar).\"\n- Provide static PNG fallback if critical for downstream PDFs.\n\n## 10. Change Log\n| Version | Date | Summary |\n|---------|------|---------|\n| 1.0.0 | 2025-08-31 | Initial import |\n| 1.1.0 | 2025-09-03 | Added practical remediation lessons: lint interplay, anchor node pattern, ASCII fallback guidance, migration recipes, expanded troubleshooting table |\n\n## 11. Summary\nAdhering to modest structural rules (blank lines, portable keywords, anchor nodes, supported diagram types) eliminates the majority of real-world Mermaid rendering failures across GitHub and Azure DevOps. Apply the 10-point authoring checklist to achieve near 100% first-pass render success.",
  "rationale": "Updated with validated remediation patterns for broken diagrams (anchor nodes, mindmap migration, lint integration, ASCII fallbacks).",
  "priority": 95,
  "audience": "developers",
  "requirement": "technical documentation on mermaid diagram compatibility across platforms",
  "categories": [
    "compatibility",
    "diagrams",
    "documentation",
    "markdown",
    "mermaid"
  ],
  "sourceHash": "d847fe5db0207dca0870560b6d5574cd4a20a277512194a4ee425fa1386264ac",
  "schemaVersion": "3",
  "createdAt": "2025-08-31T23:12:27.357Z",
  "updatedAt": "2025-09-03T21:03:12.581Z",
  "riskScore": 5,
  "version": "1.0.0",
  "status": "approved",
  "owner": "unowned",
  "priorityTier": "P4",
  "classification": "internal",
  "lastReviewedAt": "2025-08-31T23:12:27.358Z",
  "nextReviewDue": "2025-12-29T23:12:27.358Z",
  "reviewIntervalDays": 120,
  "changeLog": [
    {
      "version": "1.0.0",
      "changedAt": "2025-08-31T23:12:27.357Z",
      "summary": "initial import"
    }
  ],
  "semanticSummary": "# Mermaid Diagram Compatibility Matrix",
  "primaryCategory": "compatibility"
}